<html>
<table id="table"></table>
<script>
function main() {
  var request = new XMLHttpRequest();
  request.open('GET', "https://api.coinmarketcap.com/v1/ticker/?limit=300", true);
  request.onload = function() {
    if (request.status >= 200 && request.status < 400) {
      var resp = JSON.parse(request.responseText);
      processData(resp);
    } else {
      console.log('We reached our target server, but it returned an error')
    }
  };
  request.onerror = function() {
    console.log('There was a connection error of some sort')
  };
  request.send();
}

function processData(cmcCoins) {
  var pbCoins = {
    BTC: 25000,
    ETH: 550,
    GTO: 0.8,
    XMR: 60,
    STEEM: 3.5,
    LKK: 0.1,
    NEO: 22,
    FCT: 50,
    STORJ: 1,
    ETC: 25,
    XRP: 0.3,
    OMG: 20,
    GAS: 45,
    DASH: 800,
    CND: 0.3,
    ICN: 2,
    XEM: 0.3,
    WINGS: 1,
    LSK: 1.5,
    WAVES: 4,
    BAT: 0.35,
    BTS: 0.4,
    SYS: 0.3,
    XZC: 20,
    GNT: 0.6,
    MAID: 0.5,
    ANT: 8,
    BCH: 1400,
    EOS: 1.6,
    BNB: 2.5,
    XLM: 0.35,
    SALT: 20,
    AION: 10,
    DRGN: 5,
    WAX: 1.4,
    QTUM: 65,
    ADA: 0.9,
    POWR: 0.85,
    VET: 0.016,
    BNT: 5,
    LTC: 175,
    ICX: 5.5,
    QSP: 0.25,
    FUN: 0.04,
  };
  var btcPrice = parseFloat(cmcCoins[0]['price_usd']);
  var coinList = constructCoinList(cmcCoins, pbCoins);
  var buyList = getBuyList(coinList, btcPrice);
  var buyListSorted = sortList(buyList);
  var buyListHtml = getBuyListHtml(buyListSorted);
  renderHtml(buyListHtml, 'table');
}

function constructCoinList(cmcCoins, pbCoins) {
  var coinList = [];
  for(var pbCoin in pbCoins) {
    cmcCoins.forEach(function(cmcCoin) {
      if (pbCoin == cmcCoin.symbol) {
        c = {};
        c.symbol = pbCoin;
        c.priceUsd = parseFloat(cmcCoin.price_usd);
        c.roi = pbCoins[pbCoin] / c.priceUsd;
        coinList.push(c);
      };
    });
  };
  return coinList
}

function getBuyList(coinList, btcPrice) {
  var buyList = [];
  coinList.forEach(function(coin) {
    buyList.push({
      symbol: coin.symbol,
      price: coin.priceUsd,
      roi: coin.roi.toFixed(2),
    });
  });
  return buyList;
}

function sortList(list) {
  return list.slice(0).sort(function(a, b, c, d) {
    return b.roi - a.roi;
  });
}

function getBuyListHtml(buyListSorted) {
  var html = `
    <th scope="row">Coin</th>
    <th scope="row">Price $</th>
    <th scope="row">ROI</th>
  `;
  buyCoins = ['BTC', 'VET', 'NEO', 'XLM', 'FUN', 'FCT', 'STORJ', 'ETC', 'DASH', 'OMG', 'GAS', 'ETH', 'CND', 'AION', 'GTO', 'QSP', 'STEEM'];
  buyListSorted.forEach(function(coin) {
    html += '<tr>';
    if (buyCoins.includes(coin['symbol'])) {
      html += '<td>' + '<strong>' + coin['symbol'] + '</strong>' + '</td>';
      html += '<td>' + '<strong>' + coin['price'] + '</strong>' + '</td>';
      html += '<td>' + '<strong>' + coin['roi'] + '</strong>' + '</td>';
    } else {
      html += '<td>' + '<strike>' + coin['symbol'] + '</strike>' + '</td>';
      html += '<td>' + '<strike>' + coin['price'] + '</strike>' + '</td>';
      html += '<td>' + '<strike>' + coin['roi'] + '</strike>' + '</td>';
    };
    html += '</tr>'
  });
  return html;
}

function renderHtml(html, id) {
  document.getElementById(id).innerHTML = '';
  document.getElementById(id).innerHTML = html;
}
window.onload = main;
</script>
</html>
